name: Possible Port Scan Detected
type: cardinality
index: packetbeat-*
timeframe:
  minutes: 2

filter:
  - term:
      event.dataset: "flow"
  - term:
      network.transport: "tcp"

query_key: source.ip
cardinality_field: destination.port
min_cardinality: 20
realert:
  minutes: 10

alert:
  - post
http_post_url: "http://backend:5000/api/alerts/webhook"
http_post_json: true
http_post_all_values: true
http_post_payload:
  title: "Port scan detected"
  description: "Multiple distinct destination ports within 2 minutes"
  severity: "high"
  category: "network_intrusion"
http_post_static_payload:
  source: "automated"

